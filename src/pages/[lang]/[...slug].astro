---
import Base from '@/layouts/base.astro'
import type { GetStaticPaths } from 'astro'
import { getCollection } from 'astro:content'
import { changeLanguage } from 'i18next'

import Aside from '@/components/aside'
// mdx custom
import Ads from '@/components/mdx/ads.astro'
import Toc from '@/components/mdx/toc.astro'

export const getStaticPaths: GetStaticPaths = async () => {
	const pages = await getCollection('blog')
	const paths = pages.map((page) => {
		const [lang, ...slug] = page.slug.split('/')
		return { params: { lang, slug: slug.join('/') || undefined }, props: page }
	})
	return paths
}

const { lang } = Astro.params

changeLanguage(lang)

const page = Astro.props
const formattedDate = page.data.date.toLocaleString(lang, {
	weekday: 'long',
	year: 'numeric',
	month: 'long',
	day: 'numeric',
})

const { Content, remarkPluginFrontmatter, headings } = await page.render()
---

<Base>
	<div class="grid grid-cols-1">
		<article class="prose">
			<h1>{page.data.title}</h1>
			<h5>{remarkPluginFrontmatter.minutesRead}</h5>
			<p>by {page.data.authors.at(0)} â€¢ {formattedDate}</p>
			<Toc headings={headings} />
			<Content components={{ Ads }} />
		</article>
		<Aside headings={headings} />
	</div>
</Base>
